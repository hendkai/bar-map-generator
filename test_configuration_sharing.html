<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration Sharing Test - BAR Map Generator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .subtitle {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.2em;
            opacity: 0.9;
        }

        .test-section {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .test-section h2 {
            color: #ffd700;
            margin-top: 0;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 10px;
        }

        .step {
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .step h3 {
            margin-top: 0;
            color: #4CAF50;
        }

        .step-number {
            display: inline-block;
            background: #4CAF50;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .test-button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            flex: 1;
            min-width: 200px;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .test-button:active {
            transform: translateY(0);
        }

        .test-button.secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }

        .test-button.open-app {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
        }

        .verification-box {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4CAF50;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .verification-box h4 {
            margin-top: 0;
            color: #4CAF50;
        }

        .checkbox-list {
            list-style: none;
            padding-left: 0;
        }

        .checkbox-list li {
            margin: 10px 0;
            padding-left: 30px;
            position: relative;
        }

        .checkbox-list li:before {
            content: '‚òê';
            position: absolute;
            left: 0;
            font-size: 20px;
            color: #4CAF50;
        }

        .info-box {
            background: rgba(33, 150, 243, 0.2);
            border: 2px solid #2196F3;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .info-box h4 {
            margin-top: 0;
            color: #2196F3;
        }

        .warning-box {
            background: rgba(255, 152, 0, 0.2);
            border: 2px solid #ff9800;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .warning-box h4 {
            margin-top: 0;
            color: #ff9800;
        }

        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }

        #testResults {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .test-pass {
            color: #4CAF50;
            font-weight: bold;
        }

        .test-fail {
            color: #f44336;
            font-weight: bold;
        }

        .result-item {
            padding: 10px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Configuration Sharing Test</h1>
        <p class="subtitle">End-to-End Test for Configuration Import/Export</p>

        <div class="button-group">
            <button class="test-button open-app" onclick="openMainApp()">üöÄ Open BAR Map Generator</button>
            <button class="test-button secondary" onclick="showInstructions()">üìñ Show Test Instructions</button>
            <button class="test-button secondary" onclick="runAutomatedTest()">ü§ñ Run Automated Validation</button>
        </div>

        <div class="test-section">
            <h2>üìã Test Overview</h2>
            <p>This test verifies the complete configuration sharing workflow:</p>
            <div class="step">
                <h3><span class="step-number">1</span> Generate Configuration</h3>
                <p>Create a map with specific configuration parameters</p>
            </div>
            <div class="step">
                <h3><span class="step-number">2</span> Export to Text</h3>
                <p>Copy the configuration as a shareable text string</p>
            </div>
            <div class="step">
                <h3><span class="step-number">3</span> Simulate Page Reload</h3>
                <p>Clear all current state (simulates fresh page load)</p>
            </div>
            <div class="step">
                <h3><span class="step-number">4</span> Import Configuration</h3>
                <p>Paste the text and import the configuration</p>
            </div>
            <div class="step">
                <h3><span class="step-number">5</span> Verify Restoration</h3>
                <p>Confirm all parameters are correctly restored</p>
            </div>
        </div>

        <div class="test-section">
            <h2>üéØ Test Scenario</h2>
            <div class="info-box">
                <h4>Test Parameters</h4>
                <p>Use the following specific configuration for testing:</p>
                <ul class="checkbox-list">
                    <li><strong>Map Size:</strong> 20 (Medium)</li>
                    <li><strong>Terrain Type:</strong> Continental</li>
                    <li><strong>Player Count:</strong> 4</li>
                    <li><strong>Seed:</strong> 12345</li>
                    <li><strong>Water Level:</strong> 0.4</li>
                    <li><strong>Mountain Height:</strong> 0.7</li>
                    <li><strong>Creator Name:</strong> Test User</li>
                    <li><strong>Description:</strong> Test configuration for sharing workflow</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h2>üìù Detailed Test Steps</h2>

            <div class="step">
                <h3><span class="step-number">1</span> Prepare the Configuration</h3>
                <ol>
                    <li>Click "Open BAR Map Generator" button above</li>
                    <li>In the opened app, set the test parameters as shown above</li>
                    <li>Fill in metadata:
                        <ul>
                            <li>Creator Name: <strong>Test User</strong></li>
                            <li>Description: <strong>Test configuration for sharing workflow</strong></li>
                        </ul>
                    </li>
                    <li>Click "Generate Map" to create a map with these settings</li>
                </ol>
            </div>

            <div class="step">
                <h3><span class="step-number">2</span> Export Configuration as Text</h3>
                <ol>
                    <li>In the Configuration Import/Export section</li>
                    <li>Click the "üìã Copy Config (Text)" button</li>
                    <li>Verify you see the success message: "Configuration copied to clipboard!"</li>
                    <li><strong>Important:</strong> Paste the copied text into the box below for safekeeping</li>
                </ol>
                <textarea id="savedConfig" placeholder="Paste your exported configuration text here to save it..."></textarea>
            </div>

            <div class="step">
                <h3><span class="step-number">3</span> Simulate Fresh Page Load</h3>
                <ol>
                    <li>Close or refresh the BAR Map Generator page</li>
                    <li>This simulates a user sharing the config with someone who has never visited the page</li>
                    <li>All form fields should be at their default values</li>
                </ol>
                <div class="warning-box">
                    <h4>‚ö†Ô∏è Important</h4>
                    <p>Make sure you've saved the configuration text in the box above before refreshing! You won't be able to complete the test without it.</p>
                </div>
            </div>

            <div class="step">
                <h3><span class="step-number">4</span> Import Configuration</h3>
                <ol>
                    <li>Click "Open BAR Map Generator" again to get a fresh instance</li>
                    <li>Copy the configuration text from the box above</li>
                    <li>In the app, paste it into the "Import from Text" textarea</li>
                    <li>Click the "üìù Import from Text" button</li>
                    <li>Verify you see no error messages</li>
                </ol>
            </div>

            <div class="step">
                <h3><span class="step-number">5</span> Verify Configuration Restoration</h3>
                <div class="verification-box">
                    <h4>‚úÖ Verification Checklist</h4>
                    <ul class="checkbox-list">
                        <li>Map Size slider shows <strong>20</strong></li>
                        <li>Terrain Type dropdown shows <strong>Continental</strong></li>
                        <li>Player Count shows <strong>4</strong></li>
                        <li>Seed field shows <strong>12345</strong></li>
                        <li>Water Level slider shows <strong>0.4</strong></li>
                        <li>Mountain Height slider shows <strong>0.7</strong></li>
                        <li>Creator Name field shows <strong>Test User</strong></li>
                        <li>Description field shows <strong>Test configuration for sharing workflow</strong></li>
                        <li>Generate a new map with these settings - it should produce identical results</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>ü§ñ Automated Validation (Optional)</h2>
            <p>If you have a configuration string saved above, click the button below to validate its structure:</p>
            <div class="button-group">
                <button class="test-button" onclick="validateConfigString()">‚úì Validate Saved Configuration</button>
            </div>
            <div id="testResults"></div>
        </div>

        <div class="test-section">
            <h2>üìä Expected Results</h2>
            <div class="info-box">
                <h4>Success Criteria</h4>
                <ul>
                    <li>‚úì Configuration exports without errors</li>
                    <li>‚úì Configuration string is valid base64-encoded JSON</li>
                    <li>‚úì Configuration imports without errors</li>
                    <li>‚úì All form fields match original values exactly</li>
                    <li>‚úì Metadata (creator, description) is preserved</li>
                    <li>‚úì Generated maps are identical before and after import</li>
                </ul>
            </div>
            <div class="warning-box">
                <h4>Potential Issues to Watch For</h4>
                <ul>
                    <li>‚ö†Ô∏è Clipboard permission denied - check browser settings</li>
                    <li>‚ö†Ô∏è Invalid base64 string - ensure complete copy</li>
                    <li>‚ö†Ô∏è Parameter mismatch - verify all fields are present</li>
                    <li>‚ö†Ô∏è Version incompatibility - should show warning but still work</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h2>üìñ Manual Testing Instructions</h2>
            <p><strong>For detailed step-by-step guidance:</strong></p>
            <div class="button-group">
                <button class="test-button secondary" onclick="showInstructions()">üìñ View Full Instructions</button>
            </div>
        </div>
    </div>

    <script>
        function openMainApp() {
            // Open the main application in a new tab
            window.open('./bar_map_generator.html', '_blank');
        }

        function showInstructions() {
            alert('TEST INSTRUCTIONS:\n\n1. Open the BAR Map Generator\n2. Set the test parameters listed in the "Test Scenario" section\n3. Click "Generate Map"\n4. Click "Copy Config (Text)"\n5. Paste the config into the save box on this page\n6. Refresh/clear the main app\n7. Paste the config and import it\n8. Verify all fields match the original values\n\nSee the "Detailed Test Steps" section for more information.');
        }

        function validateConfigString() {
            const configString = document.getElementById('savedConfig').value.trim();
            const resultsDiv = document.getElementById('testResults');

            if (!configString) {
                resultsDiv.style.display = 'block';
                resultsDiv.innerHTML = '<div class="result-item test-fail">‚ùå No configuration string found. Please paste a configuration string in the text area above.</div>';
                return;
            }

            let results = [];
            let passed = 0;
            let failed = 0;

            // Test 1: Check if string is not empty
            results.push({
                name: 'Configuration string is not empty',
                passed: configString.length > 0
            });

            // Test 2: Try to decode base64
            try {
                const decoded = atob(configString);
                results.push({
                    name: 'Valid base64 encoding',
                    passed: true
                });

                // Test 3: Check if decoded string is valid JSON
                try {
                    const parsed = JSON.parse(decoded);
                    results.push({
                        name: 'Valid JSON structure',
                        passed: true
                    });

                    // Test 4: Check for required fields
                    const hasVersion = parsed.version !== undefined;
                    const hasConfig = parsed.config !== undefined;
                    const hasMetadata = parsed.metadata !== undefined;

                    results.push({
                        name: 'Contains version field',
                        passed: hasVersion
                    });
                    results.push({
                        name: 'Contains config field',
                        passed: hasConfig
                    });
                    results.push({
                        name: 'Contains metadata field',
                        passed: hasMetadata
                    });

                    // Test 5: Check config structure
                    if (hasConfig) {
                        const config = parsed.config;
                        const expectedFields = ['size', 'terrainType', 'playerCount', 'seed', 'waterLevel', 'mountainHeight'];
                        expectedFields.forEach(field => {
                            results.push({
                                name: `Config contains ${field}`,
                                passed: config[field] !== undefined
                            });
                        });
                    }

                    // Test 6: Check metadata structure
                    if (hasMetadata) {
                        const metadata = parsed.metadata;
                        results.push({
                            name: 'Metadata contains creator',
                            passed: metadata.creator !== undefined
                        });
                        results.push({
                            name: 'Metadata contains description',
                            passed: metadata.description !== undefined
                        });
                    }

                } catch (jsonError) {
                    results.push({
                        name: 'Valid JSON structure',
                        passed: false,
                        error: jsonError.message
                    });
                }

            } catch (base64Error) {
                results.push({
                    name: 'Valid base64 encoding',
                    passed: false,
                    error: base64Error.message
                });
            }

            // Count results and generate output
            passed = results.filter(r => r.passed).length;
            failed = results.filter(r => !r.passed).length;

            let output = `<h3>Test Results: ${passed} passed, ${failed} failed</h3>`;
            results.forEach(result => {
                const statusClass = result.passed ? 'test-pass' : 'test-fail';
                const icon = result.passed ? '‚úì' : '‚úó';
                const errorText = result.error ? ` - ${result.error}` : '';
                output += `<div class="result-item ${statusClass}">${icon} ${result.name}${errorText}</div>`;
            });

            const overallStatus = failed === 0 ? 'test-pass' : 'test-fail';
            const overallMessage = failed === 0 ? '‚úì All tests passed!' : '‚úó Some tests failed';
            output = `<div class="result-item ${overallStatus}" style="font-size: 1.2em; margin-bottom: 15px;">${overallMessage}</div>` + output;

            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = output;
        }

        function runAutomatedTest() {
            // Check if we can access the main app's configuration
            const configString = document.getElementById('savedConfig').value.trim();

            if (!configString) {
                alert('To run the automated test:\n\n1. First export a configuration from the main app\n2. Paste it into the save box on this page\n3. Then click "Run Automated Validation" again\n\nThis will validate the structure of your configuration string.');
                return;
            }

            validateConfigString();
        }

        // Auto-load saved config from localStorage if available
        window.addEventListener('load', () => {
            const savedConfig = localStorage.getItem('testConfigString');
            if (savedConfig) {
                document.getElementById('savedConfig').value = savedConfig;
            }
        });

        // Auto-save config to localStorage when changed
        document.getElementById('savedConfig').addEventListener('input', (e) => {
            localStorage.setItem('testConfigString', e.target.value);
        });
    </script>
</body>
</html>
